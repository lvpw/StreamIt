
void->int stateful filter A {
  int count;
  init {
     count = 0;
  }
  work push 1 {
    count++;
    push(count++);
  }
}

int->int stateful filter B {
  int count;
  init {
     count = 0;
  }
    work pop 1 push * {
      int i;     
      int amount = pop(); 
      push(amount);     
      for(i=0; i < amount; i++)
          push(count++);
   
   }
}

int->int stateful filter C {
  int count;
  init {
     count = 0;
  }    
    work pop * push 1 {
      int amount = pop();
      int i;   
      for(i=0; i < amount; i++) {
        pop();
      }
      count++;
      push(amount);      
   }
}

void->void pipeline test6 {
    add A();
    add B();
    add C();
    add Writer<int>(stdout);
}

