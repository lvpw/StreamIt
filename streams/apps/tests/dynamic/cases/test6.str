
void->int stateful filter A {
  int acount;
  init {
     acount = 0;
  }
  work push 1 {
    acount++;
    push(acount++);
  }
}

int->int stateful filter B {
  int bcount;
  init {
     bcount = 0;
  }
    work pop 1 push * {
      int i;     
      int amount = pop(); 
      push(amount);     
      for(i=0; i < amount; i++)
          push(bcount++);
   
   }
}

int->int stateful filter C {
  int ccount;
  init {
     ccount = 0;
  }    
    work pop * push 1 {
      int amount = pop();
      int i;   
      for(i=0; i < amount; i++) {
        pop();
      }
      ccount++;
      push(amount);      
   }
}

void->void pipeline test6 {
    add A();
    add B();
    add C();
    add Writer<int>(stdout);
}

