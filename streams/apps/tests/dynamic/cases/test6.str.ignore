
void->int stateful filter A {
  int count;
  init {
     count = 0;
  }
  work push 1 {
    print("Filter A\\n");
    push(count++);
  }
}

int->int stateful filter B {
  int count;
  init {
     count = 0;
  }
    work pop 1 push * {
      print("Filter B\\n");
      pop();
      int i;     
      int amount = count%10; 
      push(amount);     
      for(i=0; i < amount; i++)
          push(count++);
   
   }
}

int->int stateful filter C {
  int count;
  init {
     count = 0;
  }    
    work pop * push 1 {
      print("Filter C\\n");
      int amount = pop();
      int i;
      int x;
      for(i=0; i < amount; i++)
          pop();
      push(count++);      
   }
}

int->void filter D {
   work pop 1 {
     print("Filter D\\n");
     println(pop());
   }
}

void->void pipeline test6 {
    add A();
    add B();
    add C();
    add D();
}

