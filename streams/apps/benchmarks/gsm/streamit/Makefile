all:
	# get the include files resolved
	cpp StGsmDecoder.java Gsm.java
	cpp StGsmDecoder.str Gsm.str
	# eliminate the #'s generated by including
	perl -pi -e 's/#.*\n//g' Gsm.java
	perl -pi -e 's/#.*\n//g' Gsm.str
	# rename StGsmDecoder to Gsm
	perl -pi -e 's/StGsmDecoder/Gsm/g' Gsm.java
	# rename IntBinaryDecoder* to IntBinarySmallEndianDecoder
	perl -pi -e 's/IntBinaryDecoder/IntBinarySmallEndianDecoder/g' Gsm.java
	# compile with jikes
	jikes Gsm.java

a.out: Gsm.java
	# compile to a.out
	java at.dms.kjc.Main -s Gsm.java > out.c
	gcc -g -lm -I ${STREAMIT_HOME}/library/c out.c ~/streams/library/c/*.c

compile: all a.out

clean:
	rm -f *~
	rm -f *.class
	rm -f Gsm.java
	rm -f BinaryDecoderOutput1
	rm -f BinarySmallEndianDecoderOutput1

more-imem:
	perl -pi -e 's/SIM-CYCLES = \d*/$$&\nATTRIBUTES = IMEM_LARGE/' Makefile.streamit
