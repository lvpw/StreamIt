\section{Introduction}

Applications that are structured around streams of data are becoming
increasingly pervasive.  Stream programs include embedded systems for
sensor nets and cell phones, desktop applications such as streaming
media and networking, as well as high-performance servers such as HDTV
editing consoles and hyper-spectral imaging.  Performance is still a
critical factor in all of these domains, and programmers often
sacrifice readability, robustness, and maintainability of their code
in order to achieve it.  It is an important problem to improve the
programmability of stream programs without sacrificing performance.

One difficult aspect of stream programming is reconciling regular,
steady-state dataflow with irregular control messages.  For modeling
data paths of signal processing applications, Synchronous Dataflow
(SDF) is a popular model of computation~\cite{LM87-i}.  An SDF graph
consists of actors connected by communication channels; on each
execution, an actor must consume and produce a constant number of
items from its input and output channels.  SDF is appealing because it
can be statically scheduled and optimized.  However, the challenge
comes when there is a dynamic, unpredictable event in the stream; for
instance, an actor detects a low signal-to-noise ratio and sends a
signal to the frontend to increase the amplification.  How should the
control message be delivered?  The problem is further complicated when
there is a constraint on the timing of the message.  With the abundant
parallelism in stream programs, how can concurrent actors have a
common frame of reference with respect to time?

In this paper, we make two contributions towards improving the
programming model for stream programming.  First, we define a novel
language construct that uses data dependences in the stream graph to
provide simple and precise event handling in stream programs.  Second,
we define a stream dependence function, $\sdep$, which describes the
ordering constraints of actor firings in an SDF graph.  This
dependence information is similar to a program slice, which has a rich
body of work surrounding it~\cite{tip95slice,hrb88pdg,pugh97slice}.
Like program slicing, $\sdep$ can also facilitate debugging and
program analysis.  However, unlike program slicing, one can leverage
the static properties of SDF to provide an exact, complete, and
compact representation of $\sdep$ at compile time.  

Using $\sdep$, we formalize the semantics of our language construct
for precise event handling.  Via a case study of a frequency hopping
radio, we argue that the construct is a significant improvement over
the existing implementation practice.  We also present a fully
automatic implementation of precise event handling as part of the
StreamIt compiler infrastructure~\cite{streamitcc,streamit-asplos},
with a backend that targets a cluster of workstations.  We demonstrate
an average speedup of 48\% over StreamIt programs that do not utilize
the messaging feature.  As a result, we believe that the $\sdep$
formalism and language support for messaging enabled the simultaneous
improvement of both programmability and performance.

The rest of this paper is organized as follows.  Sections 2 and 3
define the stream dependence function and show how to calculate it
efficiently.  Section 4 describes our langugage support for precise
event handling, including a case study and implementation results.
Other applications for $\sdep$ appear in Section 5, related work in
Section 6, and Conclusions in Section 7.

%% This paper makes two contributions towards this goal.  First, we
%% formulate a stream dependence function, $\sdep$, which describes the
%% ordering constraints of node executions in a concurrent stream graph.
%% This dependence information is similar to a program
%% slice~\cite{tip95slice,hrb88pdg} in procedural programs and carries
%% with it many of the applications of slicing, including debugging and
%% program analysis.  However, unlike slicing, we restrict our input
%% domain to a Synchronous Dataflow (SDF) ~\cite{LM87-i} graph, which is
%% a natural representation for many signal processing applications.  We
%% leverage the static properties of SDF to compute $\sdep$ exactly at
%% compile time and to store the dependence information compactly.

%% The second contribution of this paper is a novel language construct
%% that uses $\sdep$ to provide simple and precise event handling in
%% stream programs.  In addition to the high-bandwidth data flow of
%% streaming applications, there are also low-bandwidth control messages
%% that adjust parameters in the stream graph; for example, toggling the
%% gain to suite the signal-to-noise ratio, or steering a microphone
%% array to follow a moving target.  Control messages are dynamic and
%% irregular, which makes them hard to integrate with a Synchronous
%% Dataflow model.  Most of all, they often have a constraint on the
%% timing of their delivery, which further complicates the programming
%% model because concurrent actors have no common frame of reference with
%% respect to time.
				   
%% We define a messaging construct that utilizes data dependences 
