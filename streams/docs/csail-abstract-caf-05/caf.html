

<div align="center">
<h3>Cache Aware Optimization of Stream Programs</h3>
   
<h4>Janis Sermulins, William Thies, Rodric Rabbah &amp; Saman Amarasinghe</h4>
</div>


<h5>Introduction</h5>

<p>
StreamIt programming language enables rapid development of digital signal 
processing (DSP) and other streaming programs in a high level programming 
language[1,2]. StreamIt optimizing compiler enables high level linear and 
space-time transformations that have been shown to reduce the number of 
floating point operations[3]. Our research shows that a stream compiler can 
use the information found in the stream program to automatically generate 
cache optimized executable. This optimization can be used to generate code 
that runs faster and consumes less energy on an embedded processors such as StrongARM.
</p>

<p>
An embedded system usually has slow memory and a fast cache. In contrast 
to desktop systems embedded system usually has only a single level of cache 
and every cache-miss results in a slow memory access. To achieve good 
performance an embedded program must have a very low cache-miss ratio.
</p>

<h5>StreamIt</h5>

<p>
A stream program consists of a graph of actors that are connected via 
communication channels. Each channel connects two actors, where one is a 
producer and the other is a consumer. Each actor examines and consumes a 
fixed number of items from its input connection and produces a fixed number
 of items onto its output connection during every execution of the actor.
</p>

<h5>Cache Aware Optimizations</h5>

<p>
Three novel transformations introduced by our research are: cache-aware 
fusion (CAF) of actors, execution scaling of the actors, and improved buffer
management. The largest speedup is achieved when we combine cache-aware 
fusion with execution 
scaling and optimized buffer management. 
</p>

<p>
The cache-aware fusion combines several adjacent actors and replaces
 them with a single new actor. This allows the compiler to perform optimizations 
across actor boundaries. For example intermediate values that a source passes 
to a destination over a communication channel can be register allocated if the 
two actors have been combined using fusion. Register allocation leads to reduction 
of memory accesses that the program issues reducing the memory bottleneck.
</p>

<p>
The execution scaling executes each actor multiple times. Execution scaling 
reduces the number of cache misses for accessing the instructions of the scaled 
actor (if all code of the actor fits into the instruction cache) and it also 
reduces the number of cache misses for accessing the state of the scaled actor 
(if all state of the actor fits into the data cache).
</p>

<p>
Some actors examine many items on the input channel but only consume (remove) 
few items. In such case the stream compiler has to decide how the live items 
should be buffered. We examine several alternative methods for buffer management 
such as modulation and shifting the live items within a large buffer.
</p>

<h5>Conclusion</h5>

<p>
Our research has shown that to execute high level stream programs on an embedded 
processor such as StrongARM (used in many handheld devices) one has to take into 
account the caching behavior of the generated code. CAF and optimized buffer 
management reduces the number of memory accesses issued by the program. Execution 
scaling reduces the number of cache misses. A combination of all of the mentioned 
optimizations reduces the memory bottleneck and results in a substantial speedup 
for stream programs on embedded processors.
</p>

<p>
<img src="arm1.gif" alt="Performance of various compilation strategies on a StrongARM"><br>
<strong>Figure 1.</strong> Performance of various compilation strategies on a StrongARM.
</p>

<p>
<img src="arm2.gif" alt="Full fusion versus CAF+scaling+buffer on a StrongARM"><br>
<strong>Figure 2.</strong> Full fusion versus <em>CAF+scaling+buffer</em> on a StrongARM.
</p>

<h5>References:</h5>

<p>[1] William Thies, Michal Karczmarek, and Saman Amarasinghe. 
StreamIt: A Language for Streaming Applications. 
In <em>Proceedings of the 2002 International Conference on Compiler Construction</em>. 
Grenoble, France, April, 2002.</p>

<p>[2] Kimberly Kuo, Rodric Rabbah, and Saman Amarasinghe. 
A Productive Programming Environment for Stream Computing. 
In <e>Second Workshop on Productivity and Performance in High-End Computing</em>, 
pp. 35--44, San Francisco, February 13, 2005.</p>

<p>[3] Andrew A. Lamb, William Thies, and Saman Amarasinghe. 
Linear Analysis and Optimization of Stream Programs. 
In <em>Proceedings of the SIGPLAN '03 Conference on Programming Language Design and Implementation</em>, 
San Diego, CA, June, 2003.</p>

<!--
[1] Author A. Lastname and Author B. Lastname. 
Title of the paper. In <em>The Proceedings of the Conference</em>, 
pp. 1--3, City, State, Country, Month 2004. </p>
-->

