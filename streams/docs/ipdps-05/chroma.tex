\SubSection{Video Sampling Rate}

Macroblocks specify colors using a luminance channel to represent
saturation (color intensity), and two chrominance channels to
represent hue. The human eye is more sensitive to changes in
saturation than changes in hue, so the chrominance channels are
frequently compressed by downsampling the chrominance data within a
macroblock. The type of chrominance downsampling an MPEG-2 encoder
uses is its {\it chrominance format}. The most common chrominance
format is 4:2:0, which uses a single block for each of the chrominance
channels, downsampling each of the two channels from 16x16 to 8x8.  An
alternate chrominance format is 4:2:2. It uses two blocks for each
chrominance channel, downsampling each of the channels from 16x16 to
8x16. The possible chrominance formats are shown in
Figure~\ref{fig:chroma-format}.

To support the 4:2:2 chrominance format in our StreamIt decoder, we
modified 31 lines and added 20 new lines. Of the 31 modified lines, 23
were trivial modifications to pass a variable representing the
chrominance format as a stream parameter. The greatest substantial
change was to the decoding splitjoin previously illustrated in
Figure~\ref{fig:decoding-sj}. In the case of a 4:2:2 sampling rate,
the chrominance data, as it appears on the input tape, alternates
between each of the two chrominance channels. Thus, a a two-tiered
splitjoin is used to properly recover the appropriate chrominance
channels. The new splitjoin is shown in Figure~\ref{fig:chroma-format}.
\begin{figure*}[t]
 \begin{minipage}[t]{4.0in}
   {
    \begin{scriptsize}
    \begin{verbatim} 
    // N = macroblock size + motion vector data size;
    // W = picture width (resolution in pixels);
    // H = picture width (resolution in pixels);

    int->int splitjoin(int chromaFormat) {
      int xUpSample, yUpSample;

      if (chromaFormat == 420) { // 4:2:0 chroma format
        split roundrobin(4*N, 2*N);
        xUpSample = yUpSample = 2;
      } else {                   // 4:2:2 chroma format
        split roundrobin(4*N, 4*N);
        xUpSample = 2;
        yUpSample = 0;
      }

      add LuminanceChannel(W, H, 0, 0, chromaFormat);

      add int->int splitjoin {
        split roundrobin(N, N);
        add ChrominanceChannel(W, H, xUpsample, yUpSample, chromaFormat);
        add ChrominanceChannel(W, H, xUpsample, yupsample, chromaFormat);
        join roundrobin(1, 1);
      }

      join roundrobin(1, 2);
    }
    \end{verbatim}
    \end{scriptsize}
   }
   % \vspace{-3pt}
   \caption{Decoding stream to handle 4:2:0 and 4:2:2 chroma formats.}
   \label{fig:chroma-stream}
  \end{minipage}
  \begin{minipage}[t]{2.0in}
  {
   \begin{center}
    \epsfig{file=chroma_format.eps, width=3in}
    \caption{4:2:0 and 4:2:2 chrominance formats showing macroblock ordering}
    \label{fig:chroma-format}
   \end{center}
  }
  \end{minipage}
\end{figure*}



