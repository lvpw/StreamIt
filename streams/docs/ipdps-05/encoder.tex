\Section{MPEG Encoder in StreamIt}

Our MPEG-2 decoder is fully implemented and functional. We are also
implementing an MPEG-2 encoder in StreamIt. To date, our encoder is
functional although it does not yet implement motion estimation. Thus,
the encoder does not achieve any compression of the input video
stream. The implementation of the motion estimator is our current
focus.

Our implementation of the MPEG-2 encoder exploits data parallelism
among macroblocks, as in the case of the decoder.  In terms of the
motion estimation, each stream searches through a stored reference
picture to find the best match for the macroblock it is  encoding. The
MPEG-2 standard does not specify a minimum or maximum search window
for motion estimation: it may be as large as the entire reference
picture or as small as a few pixels.  In the case where the encoder
searches the entire reference picture, every stream requires its own
private copy of the reference picture. In StreamIt, teleport messaging
serves to broadcast the reference pictures to the encoding streams.

An alternate implementation can exploit the fact that the MPEG-2
standard does not specify a maximum search window, and thus, it can
impose a maximum length on the search area, thereby restricting the
length of the motion vectors produced by our encoder.  The upper bound
on motion vector lengths limits the number of reference macroblocks
that need to be stored for motion estimation.

In StreamIt, the maximum search window size is modeled with a stream
parameter which can be tuned according to various criteria.  Larger
search windows have the potential for finding better matches and thus
a more compact encoding.  Smaller search windows limit the amount of
communication, offering faster performance at the cost of either less
compression or lower quality images.  The ideal window size depends on
the number of streams, the size of the pictures, and the relative
importance of encoder speed and output quality. A programmable
StreamIt MPEG-2 encoder thus affords significant flexibility.